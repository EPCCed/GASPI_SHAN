\hypertarget{SHAN__segment_8h}{}\section{include/\+S\+H\+A\+N\+\_\+segment.h File Reference}
\label{SHAN__segment_8h}\index{include/\+S\+H\+A\+N\+\_\+segment.\+h@{include/\+S\+H\+A\+N\+\_\+segment.\+h}}


S\+H\+A\+N\+\_\+segment header for notifications in shared memory.  


{\ttfamily \#include $<$mpi.\+h$>$}\\*
Include dependency graph for S\+H\+A\+N\+\_\+segment.\+h\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=210pt]{SHAN__segment_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{SHAN__segment_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structshan__notification__t}{shan\+\_\+notification\+\_\+t}
\item 
struct \hyperlink{structshan__segment__t}{shan\+\_\+segment\+\_\+t}
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries shan\+\_\+type} \{ {\bfseries S\+H\+A\+N\+\_\+\+D\+A\+TA} = 0, 
{\bfseries S\+H\+A\+N\+\_\+\+T\+Y\+PE} = 1
 \}\hypertarget{SHAN__segment_8h_abe976d0a720ecb25d9342ca38c2ad206}{}\label{SHAN__segment_8h_abe976d0a720ecb25d9342ca38c2ad206}

\item 
enum {\bfseries shan\+\_\+return\+\_\+val} \{ {\bfseries S\+H\+A\+N\+\_\+\+E\+R\+R\+OR} = -\/2, 
{\bfseries S\+H\+A\+N\+\_\+\+F\+A\+IL} = -\/1, 
{\bfseries S\+H\+A\+N\+\_\+\+S\+U\+C\+C\+E\+SS} = 0
 \}\hypertarget{SHAN__segment_8h_a4690c63731c30ab1590c4e0f527526d2}{}\label{SHAN__segment_8h_a4690c63731c30ab1590c4e0f527526d2}

\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{SHAN__segment_8h_aa45eee114648cecfe8d17e6e3f9c225b}{shan\+\_\+alloc\+\_\+shared} (\hyperlink{structshan__segment__t}{shan\+\_\+segment\+\_\+t} $\ast$const segment, const int shan\+\_\+id, const int shan\+\_\+type, const long data\+Sz, const M\+P\+I\+\_\+\+Comm M\+P\+I\+\_\+\+C\+O\+M\+M\+\_\+\+S\+HM)
\item 
int \hyperlink{SHAN__segment_8h_a149299eae702b7dd00dc5202d0fd177b}{shan\+\_\+free\+\_\+shared} (\hyperlink{structshan__segment__t}{shan\+\_\+segment\+\_\+t} $\ast$const segment)
\item 
int \hyperlink{SHAN__segment_8h_ac38c381b88611d910071682226d80106}{shan\+\_\+get\+\_\+shared\+\_\+ptr} (\hyperlink{structshan__segment__t}{shan\+\_\+segment\+\_\+t} $\ast$const segment, const int rank, void $\ast$$\ast$shm\+\_\+ptr)
\item 
int \hyperlink{SHAN__segment_8h_a0d0ee047fe4462c73a6312e039d34970}{shan\+\_\+notify\+\_\+reset\+\_\+shared} (\hyperlink{structshan__notification__t}{shan\+\_\+notification\+\_\+t} $\ast$const ptr, const int idx, int $\ast$const val)
\item 
int \hyperlink{SHAN__segment_8h_a80250638151a878ad4595dbac46b0232}{shan\+\_\+notify\+\_\+increment\+\_\+shared} (\hyperlink{structshan__notification__t}{shan\+\_\+notification\+\_\+t} $\ast$const ptr, const int idx, const int increment)
\item 
int \hyperlink{SHAN__segment_8h_a0aaa2901cb622fbf2f12145418656aa9}{shan\+\_\+notify\+\_\+test\+\_\+shared} (\hyperlink{structshan__notification__t}{shan\+\_\+notification\+\_\+t} $\ast$const ptr, const int idx, int $\ast$const val)
\item 
int \hyperlink{SHAN__segment_8h_a7686b269f38366738e142f0fc984ea06}{shan\+\_\+notify\+\_\+init\+\_\+shared} (\hyperlink{structshan__notification__t}{shan\+\_\+notification\+\_\+t} $\ast$const ptr, const int idx)
\end{DoxyCompactItemize}


\subsection{Detailed Description}
S\+H\+A\+N\+\_\+segment header for notifications in shared memory. 

The S\+H\+AN (S\+H\+A\+\_\+red N\+\_\+otifications) interface is a user-\/level A\+PI which aims at migrating flat M\+PI (legacy) code towards an asynchronous dataflow model. S\+H\+AN uses the G\+A\+S\+PI A\+PI and extends ideas from M\+PI shared windows.

G\+A\+S\+PI is a P\+G\+AS communication library which is based on the concept of one-\/sided, notified communication. The synchronization context here is bundled together with a one-\/sided message such that a communication target becomes able to test for completion of the received one-\/sided communication.

Traditionally the G\+A\+S\+PI programming model has been aimed at multithreaded or task-\/based applications. In G\+A\+S\+PI the synchronization context is bundled together with a one-\/sided message such that a communication target becomes able to test for completion of the received one-\/sided communication.

In order to support a migration of legacy applications (with a flat M\+PI communication model) towards G\+A\+S\+PI, we have extended the concept of shared M\+PI windows towards a notified communication model in which the processes sharing a common window become able to see all one-\/sided and notified communication targeted at this window. Similarly we have extended the concept of M\+PI shared windows with shared notifications, which are globally visible in shared memory.

Besides the possibility to entirely avoid node-\/internal communication and to make use of a much improved overlap of communication and computation the model of notified communication in G\+A\+S\+PI shared windows will allow legacy S\+P\+MD applications a transition towards an asynchronous dataflow model. 

\subsection{Function Documentation}
\index{S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}!shan\+\_\+alloc\+\_\+shared@{shan\+\_\+alloc\+\_\+shared}}
\index{shan\+\_\+alloc\+\_\+shared@{shan\+\_\+alloc\+\_\+shared}!S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}}
\subsubsection[{\texorpdfstring{shan\+\_\+alloc\+\_\+shared(shan\+\_\+segment\+\_\+t $\ast$const segment, const int shan\+\_\+id, const int shan\+\_\+type, const long data\+Sz, const M\+P\+I\+\_\+\+Comm M\+P\+I\+\_\+\+C\+O\+M\+M\+\_\+\+S\+H\+M)}{shan_alloc_shared(shan_segment_t *const segment, const int shan_id, const int shan_type, const long dataSz, const MPI_Comm MPI_COMM_SHM)}}]{\setlength{\rightskip}{0pt plus 5cm}int shan\+\_\+alloc\+\_\+shared (
\begin{DoxyParamCaption}
\item[{{\bf shan\+\_\+segment\+\_\+t} $\ast$const}]{segment, }
\item[{const int}]{shan\+\_\+id, }
\item[{const int}]{shan\+\_\+type, }
\item[{const long}]{data\+Sz, }
\item[{const M\+P\+I\+\_\+\+Comm}]{M\+P\+I\+\_\+\+C\+O\+M\+M\+\_\+\+S\+HM}
\end{DoxyParamCaption}
)}\hypertarget{SHAN__segment_8h_aa45eee114648cecfe8d17e6e3f9c225b}{}\label{SHAN__segment_8h_aa45eee114648cecfe8d17e6e3f9c225b}
Local allocation of shared memory of size data\+Sz

Note\+: Memory will be page-\/aligned.


\begin{DoxyParams}{Parameters}
{\em segment} & -\/ segment handle \\
\hline
{\em shan\+\_\+id} & -\/ (unique) segment id \\
\hline
{\em shan\+\_\+type} & -\/ type of allocated memory \\
\hline
{\em data\+Sz} & -\/ required memory size per rank in byte \\
\hline
{\em M\+P\+I\+\_\+\+C\+O\+M\+M\+\_\+\+S\+HM} & -\/ shared mem communicator\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\+H\+A\+N\+\_\+\+S\+U\+C\+C\+E\+SS in case of success, S\+H\+A\+N\+\_\+\+E\+R\+R\+OR in case of error. 
\end{DoxyReturn}
\index{S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}!shan\+\_\+free\+\_\+shared@{shan\+\_\+free\+\_\+shared}}
\index{shan\+\_\+free\+\_\+shared@{shan\+\_\+free\+\_\+shared}!S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}}
\subsubsection[{\texorpdfstring{shan\+\_\+free\+\_\+shared(shan\+\_\+segment\+\_\+t $\ast$const segment)}{shan_free_shared(shan_segment_t *const segment)}}]{\setlength{\rightskip}{0pt plus 5cm}int shan\+\_\+free\+\_\+shared (
\begin{DoxyParamCaption}
\item[{{\bf shan\+\_\+segment\+\_\+t} $\ast$const}]{segment}
\end{DoxyParamCaption}
)}\hypertarget{SHAN__segment_8h_a149299eae702b7dd00dc5202d0fd177b}{}\label{SHAN__segment_8h_a149299eae702b7dd00dc5202d0fd177b}
Free shared memory.


\begin{DoxyParams}{Parameters}
{\em segment} & -\/ segment handle\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\+H\+A\+N\+\_\+\+S\+U\+C\+C\+E\+SS in case of success, S\+H\+A\+N\+\_\+\+E\+R\+R\+OR in case of error. 
\end{DoxyReturn}
\index{S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}!shan\+\_\+get\+\_\+shared\+\_\+ptr@{shan\+\_\+get\+\_\+shared\+\_\+ptr}}
\index{shan\+\_\+get\+\_\+shared\+\_\+ptr@{shan\+\_\+get\+\_\+shared\+\_\+ptr}!S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}}
\subsubsection[{\texorpdfstring{shan\+\_\+get\+\_\+shared\+\_\+ptr(shan\+\_\+segment\+\_\+t $\ast$const segment, const int rank, void $\ast$$\ast$shm\+\_\+ptr)}{shan_get_shared_ptr(shan_segment_t *const segment, const int rank, void **shm_ptr)}}]{\setlength{\rightskip}{0pt plus 5cm}int shan\+\_\+get\+\_\+shared\+\_\+ptr (
\begin{DoxyParamCaption}
\item[{{\bf shan\+\_\+segment\+\_\+t} $\ast$const}]{segment, }
\item[{const int}]{rank, }
\item[{void $\ast$$\ast$}]{shm\+\_\+ptr}
\end{DoxyParamCaption}
)}\hypertarget{SHAN__segment_8h_ac38c381b88611d910071682226d80106}{}\label{SHAN__segment_8h_ac38c381b88611d910071682226d80106}
Gets shared mem pointer for node local ranks


\begin{DoxyParams}{Parameters}
{\em segment} & -\/ segment handle \\
\hline
{\em rank} & -\/ node local rank id \\
\hline
{\em shm\+\_\+ptr} & -\/ required memory size per rank in byte\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\+H\+A\+N\+\_\+\+S\+U\+C\+C\+E\+SS in case of success, S\+H\+A\+N\+\_\+\+E\+R\+R\+OR in case of error. 
\end{DoxyReturn}
\index{S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}!shan\+\_\+notify\+\_\+increment\+\_\+shared@{shan\+\_\+notify\+\_\+increment\+\_\+shared}}
\index{shan\+\_\+notify\+\_\+increment\+\_\+shared@{shan\+\_\+notify\+\_\+increment\+\_\+shared}!S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}}
\subsubsection[{\texorpdfstring{shan\+\_\+notify\+\_\+increment\+\_\+shared(shan\+\_\+notification\+\_\+t $\ast$const ptr, const int idx, const int increment)}{shan_notify_increment_shared(shan_notification_t *const ptr, const int idx, const int increment)}}]{\setlength{\rightskip}{0pt plus 5cm}int shan\+\_\+notify\+\_\+increment\+\_\+shared (
\begin{DoxyParamCaption}
\item[{{\bf shan\+\_\+notification\+\_\+t} $\ast$const}]{ptr, }
\item[{const int}]{idx, }
\item[{const int}]{increment}
\end{DoxyParamCaption}
)}\hypertarget{SHAN__segment_8h_a80250638151a878ad4595dbac46b0232}{}\label{SHAN__segment_8h_a80250638151a878ad4595dbac46b0232}
Increments shared mem notfication. Sets write fence such that local result is valid, once the incremented value is visible for other local ranks.


\begin{DoxyParams}{Parameters}
{\em ptr} & -\/ pointer to shared notification array \\
\hline
{\em idx} & -\/ shared mem notification id \\
\hline
{\em increment} & -\/ increment value\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\+H\+A\+N\+\_\+\+S\+U\+C\+C\+E\+SS in case of success, S\+H\+A\+N\+\_\+\+E\+R\+R\+OR in case of error. 
\end{DoxyReturn}
\index{S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}!shan\+\_\+notify\+\_\+init\+\_\+shared@{shan\+\_\+notify\+\_\+init\+\_\+shared}}
\index{shan\+\_\+notify\+\_\+init\+\_\+shared@{shan\+\_\+notify\+\_\+init\+\_\+shared}!S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}}
\subsubsection[{\texorpdfstring{shan\+\_\+notify\+\_\+init\+\_\+shared(shan\+\_\+notification\+\_\+t $\ast$const ptr, const int idx)}{shan_notify_init_shared(shan_notification_t *const ptr, const int idx)}}]{\setlength{\rightskip}{0pt plus 5cm}int shan\+\_\+notify\+\_\+init\+\_\+shared (
\begin{DoxyParamCaption}
\item[{{\bf shan\+\_\+notification\+\_\+t} $\ast$const}]{ptr, }
\item[{const int}]{idx}
\end{DoxyParamCaption}
)}\hypertarget{SHAN__segment_8h_a7686b269f38366738e142f0fc984ea06}{}\label{SHAN__segment_8h_a7686b269f38366738e142f0fc984ea06}
Tests for shared mem notfication.


\begin{DoxyParams}{Parameters}
{\em ptr} & -\/ pointer to shared notification array \\
\hline
{\em idx} & -\/ shared mem notification id\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\+H\+A\+N\+\_\+\+S\+U\+C\+C\+E\+SS in case of success, S\+H\+A\+N\+\_\+\+E\+R\+R\+OR in case of error. 
\end{DoxyReturn}
\index{S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}!shan\+\_\+notify\+\_\+reset\+\_\+shared@{shan\+\_\+notify\+\_\+reset\+\_\+shared}}
\index{shan\+\_\+notify\+\_\+reset\+\_\+shared@{shan\+\_\+notify\+\_\+reset\+\_\+shared}!S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}}
\subsubsection[{\texorpdfstring{shan\+\_\+notify\+\_\+reset\+\_\+shared(shan\+\_\+notification\+\_\+t $\ast$const ptr, const int idx, int $\ast$const val)}{shan_notify_reset_shared(shan_notification_t *const ptr, const int idx, int *const val)}}]{\setlength{\rightskip}{0pt plus 5cm}int shan\+\_\+notify\+\_\+reset\+\_\+shared (
\begin{DoxyParamCaption}
\item[{{\bf shan\+\_\+notification\+\_\+t} $\ast$const}]{ptr, }
\item[{const int}]{idx, }
\item[{int $\ast$const}]{val}
\end{DoxyParamCaption}
)}\hypertarget{SHAN__segment_8h_a0d0ee047fe4462c73a6312e039d34970}{}\label{SHAN__segment_8h_a0d0ee047fe4462c73a6312e039d34970}
Resets shared mem notification.


\begin{DoxyParams}{Parameters}
{\em ptr} & -\/ pointer to shared notification array \\
\hline
{\em idx} & -\/ shared mem notification id \\
\hline
{\em val} & -\/ old value of the notification\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\+H\+A\+N\+\_\+\+S\+U\+C\+C\+E\+SS in case of success, S\+H\+A\+N\+\_\+\+E\+R\+R\+OR in case of error. 
\end{DoxyReturn}
\index{S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}!shan\+\_\+notify\+\_\+test\+\_\+shared@{shan\+\_\+notify\+\_\+test\+\_\+shared}}
\index{shan\+\_\+notify\+\_\+test\+\_\+shared@{shan\+\_\+notify\+\_\+test\+\_\+shared}!S\+H\+A\+N\+\_\+segment.\+h@{S\+H\+A\+N\+\_\+segment.\+h}}
\subsubsection[{\texorpdfstring{shan\+\_\+notify\+\_\+test\+\_\+shared(shan\+\_\+notification\+\_\+t $\ast$const ptr, const int idx, int $\ast$const val)}{shan_notify_test_shared(shan_notification_t *const ptr, const int idx, int *const val)}}]{\setlength{\rightskip}{0pt plus 5cm}int shan\+\_\+notify\+\_\+test\+\_\+shared (
\begin{DoxyParamCaption}
\item[{{\bf shan\+\_\+notification\+\_\+t} $\ast$const}]{ptr, }
\item[{const int}]{idx, }
\item[{int $\ast$const}]{val}
\end{DoxyParamCaption}
)}\hypertarget{SHAN__segment_8h_a0aaa2901cb622fbf2f12145418656aa9}{}\label{SHAN__segment_8h_a0aaa2901cb622fbf2f12145418656aa9}
Tests for shared mem notfication.


\begin{DoxyParams}{Parameters}
{\em ptr} & -\/ pointer to shared notification array \\
\hline
{\em idx} & -\/ shared mem notification id \\
\hline
{\em val} & -\/ current notification value\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\+H\+A\+N\+\_\+\+S\+U\+C\+C\+E\+SS in case of success, S\+H\+A\+N\+\_\+\+E\+R\+R\+OR in case of error. 
\end{DoxyReturn}
